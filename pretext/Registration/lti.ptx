<section xml:id="lti_integration">
    <title>Integrating with your LMS</title>
    <subsection>
        <title>Introduction</title>
        <p>
            Runestone provides a rudimentary LTI integration using LTI 1.1. So far we have made this work very successfully with Canvas, Moodle, and Brightspace D2L. Others may or may not work. I call this a community supported feature of Runestone because LTI is a huge pain to work with, and it is very difficult to get access to and test against whatever LMS your school has chosen.</p>
        <p> When you use LTI your students do NOT and should not register on Runestone Academy, the LTI interface registers your student with Runestone the first time they access it from your LMS. In addition, Instructors need to use one of the LTI links to your book in order for grades to transfer. </p>
    </subsection>
    <subsection>
        <title>Phase 1 (All LMS platforms)</title>
        <p>
            Generate a shared/secret key pair for use with Canvas:

            <ol>
                <li> Browse to the
                    <url href="https://runestone.academy" visual="Runestone Academy" />
 and log in, then select your course (you must be the Instructor).
                </li>
                <li>
                    <p>Browse to the
                        <url href="https://runestone.academy/runestone/admin/admin" visual="Instructor's Page" />
, then click on “LTI Integration” in the Admin tab.</p>
                    <image source="Figures/lti_config.png" description="LTI configuration panel" />
                </li>
                <li> Click on the “Create LTI Key and Secret” button. Click the “Show Secret” button. You will use these in the next phase.</li>
            </ol>
        </p>
    </subsection>

    <subsection>
        <title>Phase 2 (LMS-specific Steps)</title>
        <introduction>
            <p>
                Follow instructions for your LMS:
            </p>
        </introduction>

        <subsubsection>
            <title>Canvas</title>
            <ol>
                <li> Follow the
                    <url href="https://community.canvaslms.com/t5/Instructor-Guide/How-do-I-configure-a-manual-entry-external-app-for-a-course/ta-p/1137" visual="Canvas instructions" />
 to add an external app:

                    <pre>
    :Name: Runestone
    :Consumer key: Enter this from Phase 1.
    :Shared Secret: Enter this from Phase 1.
    :Launch URL: ``https://runestone.academy/runestone/lti``
    :Domain: Leave blank.
    :Privacy: Select Public; otherwise, Runestone won’t work.
    :Custom Fields: Depends on the installation type:

        -   For a site-wide installation, or for installing the Runestone external app for use across multiple courses, leave this blank.
        -   If installing for a single course, add ``custom_course_id=xxx``, where ``xxx`` is the Runestone ID of the course (visible in the upper lefthand corner of each page in your Runestone course).
    :Description: Interactive textbooks from Runestone Academy
                    </pre>
                </li>
                <li>
                    <p>Add an assignment in Canvas that uses the Runestone external tool:
                        <ol>
                            <li> At `Runestone Academy`_, create an assignment; be sure you’ve checked the “Visible to Students” box and saved that change.</li>
                            <li> Still on the assignments page, copy the LTI link.</li>
                            <li> In Canvas, add an assignment. For the submission type, select “External Tool.” For the External Tool URL, use the LTI link you just copied. You’ll have to manually enter the same due date/time and a similar assignment name; these aren’t copied automatically. You must be sure the Load This Tool In A New Tab checkbox is checked.</li>
                        </ol>
                    </p>
                    <li> Students can now click on this assignment and work it. **If they don’t click on the assignment, they won’t receive a grade.**</li>
                    <li> When the assignment is due, go to Runestone directly from your Canvas course by using an assignment link. Otherwise, grade reporting won’t work.</li>
                    <li> In the grading tab of the instructor interface, grade the assignment, then click the “Release Grades” button. Doing this will push all grades to Canvas.</li>
                </li>
            </ol>
        </subsubsection>

        <subsubsection>
            <title>Moodle</title>
            <p>
                <ol>
                    <li> The following instructions are for Moodle, but should work for any LMS with LTI Support. Please note that certain items may have naming variations (ie. Moodle External Tool / Canvas External App).</li>

                    <li>
                        <p>In Moodle, create a new external tool called "LTI Login Link".</p>
                        <pre>
        :Name: Login to Runestone
        :Tool URL: https://yourHost.blahblah.edu/runestone/lti
        :Consumer key: Enter the key you copied for `consumer` from Phase 1
        :Shared secret: Enter the key you copied for `secret` from Phase 1
        :Icon URL: https://yourHost.blahblah.edu/runestone/static/images/logo_small.png
        :Share Email: True
        :Share Name: True
        :Custom params: custom_course_id=xxx, where xxx is the Runestone ID of the course (visible in the upper lefthand corner of each page in your Runestone course).
                        </pre>
                    </li>
                    <li> Login to your Runestone instance with the tool just created, and create your class as well as your assignments.</li>

                    <li>
                        <p> In Moodle, create a new enrollment external app directly to your course and assignment. You will need to repeat this for each assignment. You will also need the database values for your course ID, and assignment ID. Get these from step 2.2. Please note that in order to receive roles and grades, "Accept Grades" must be checked in Moodle. In other LMS's this may be referenced by a "Share IMS Names and Roles" or similar.</p>
                        <pre>
        :Name: Assignment 1
        :Tool URL: https://runestone.colorado.edu/runestone/lti?assignment_id=&amp;custom_course_id
        :Consumer key: Enter the key you copied for `consumer` from Phase 1
        :Shared secret: Enter the key you copied for `secret` from Phase 1
        :Icon URL: https://yourHost.blahblah.edu/runestone/static/images/logo_small.png
        :Share Email: True
        :Share Name: True
        :Custom params:
        :Accept Grades: True
                        </pre>
                    </li>
                    <li> Copy the tool as many times as you need within your Moodle Course, updating the Name and Tool URL each time.</li>

                    <li> Students can now click on these external tool assignments to be enrolled/logged directly into your Runestone course and assignment. The grades should appear in Moodle once they are released in Runestone through the Instructor interface.</li>

                    <li> The course instructor must also be an LTI sourced user, so use the "LTI Login Link" URL. This can be hidden for users.</li>
                </ol>
            </p>
        </subsubsection>
    </subsection>

    <subsubsection>
        <title>Brightspace D2L</title>
        <ol>
            <li> Depending on how D2L is set up, you may need to be an administrator in order to set up your links for class. However, in some setups, instructors have permission to make their own LTI links.
            </li>
            <li>
                <p>
                    To check, while in your class on D2L, you can go to Course Admin - External Learning Tools, then click the "Manage Tool Links (Legacy)". From their click the "New Link" button.
                </p>
            </li>
            <li> If that is successful, then here are the settings.


                <pre>
:Title: Enter either the Textbook Name or the assignment name on Runestone
:URL: copy this from the LTI configuration panel for the textbook login ``https://runestone.academy/runestone/lti`` or from the individual assignment in the Assignments tab of the Instructor's Page.
:Description: Leave blank or add a description.
:Visibility: Allow users to view the link should be checked.
:Key/Secret:
:Signature: check Sign messages with key/secret with and select Link key/secret then fill in 

:Key: Enter this from Phase 1.
:Secret: Enter this from Phase 1.
</pre>
Click the Save button before adding custom parameters.

<pre>
:Custom Parameters: 

    -   click the "Add custom parameters" link.
    -   :Name: ``custom_course_id``
    -   :Value: the Runestone ID of the course (visible in the upper lefthand corner of each page in your Runestone course).

:Security Settings:

Select "use link security settings"
make sure at least the following settings are checked:
 
    - Send tool consumer information to tool provider
    - Send context information to tool provider
    - Send LTI user ID and LTI role list to tool provider
    - Send user name to tool provider
    - Send user email to tool provider
    - Send link title to tool provider
    - Send link description to tool provider

  </pre>
            </li>
            <li> Once everything is selected, click "Save and Close" </li>
            <li>
                <p>
                    Now, from anywhere in your course, you can select  Existing Activities - External Learning Tools and then the link you created. After adding this link, make sure that you make sure the link is configured to "Open as External Resource". That way the right information will be passed to the textbook.
                </p>
            </li>
            <li> Students will be able to click on this link when you make it available to them. **If they don't click on the assignment, they won't receive a grade, so when you make the assignment on runestone, you probably want the "Visible to Students" checkbox to remain unchecked. This way it will only be available from the D2L link. **</li>
            <li> When the assignment is due, go to Runestone directly from your D2L course by using an assignment link. Otherwise, grade reporting won't work.</li>
            <li> In the grading tab of the instructor interface, grade the assignment, then click the "Release Grades" button. Doing this will push all grades to D2L.</li>
            </li>
        </ol>
    </subsubsection>
</section>
